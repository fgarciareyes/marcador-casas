<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcador de Competencias</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --cartago: #4CAF50;
            --hipona: #2196F3;
            --milan: #F44336;
            --tagaste: #FFC107;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            font-size: 24px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav li {
            margin-left: 20px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav a:hover, nav a.active {
            background-color: rgba(255,255,255,0.2);
        }
        
        .page {
            display: none;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 20px;
        }
        
        .page.active {
            display: block;
        }
        
        .login-form {
            max-width: 400px;
            margin: 50px auto;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .houses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .house-card {
            border-radius: 8px;
            padding: 15px;
            color: white;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .house-card.cartago {
            background-color: var(--cartago);
        }
        
        .house-card.hipona {
            background-color: var(--hipona);
        }
        
        .house-card.milan {
            background-color: var(--milan);
        }
        
        .house-card.tagaste {
            background-color: var(--tagaste);
            color: #333;
        }
        
        .house-card h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .house-card .score {
            font-size: 32px;
            font-weight: bold;
        }
        
        .chart-container {
            margin-top: 30px;
            height: 400px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .results-table th, .results-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .results-table th {
            background-color: #f2f2f2;
        }
        
        .winner-cell {
            font-weight: bold;
        }
        
        .points-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-section {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
        }
        
        .form-section h3 {
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        
        .grade-section {
            grid-column: 1 / -1;
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .logout-btn {
            background-color: #e74c3c;
        }
        
        .logout-btn:hover {
            background-color: #c0392b;
        }
        
        .current-grade {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .report-btn {
            background-color: #27ae60;
            margin-left: 10px;
        }
        
        .report-btn:hover {
            background-color: #219a52;
        }
        
        /* Estilos para el PDF */
        .pdf-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        
        .pdf-footer {
            text-align: center;
            margin-top: 20px;
            border-top: 1px solid #333;
            padding-top: 10px;
            font-size: 12px;
            color: #666;
        }
        
        .pdf-section {
            margin-bottom: 30px;
        }
        
        .pdf-chart-container {
            height: 300px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .points-form {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 10px;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <h1>Marcador de Competencias</h1>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="results">Resultados</a></li>
                    <li><a href="#" class="nav-link" data-page="login">Ingresar Puntos</a></li>
                    <li><button id="report-btn" class="report-btn">Generar Reporte PDF</button></li>
                </ul>
            </nav>
        </div>
    </header>
    
    <div class="container">
        <!-- Página de resultados -->
        <div id="results" class="page active">
            <h2>Resultados por Casa</h2>
            
            <div class="houses-grid">
                <div class="house-card cartago">
                    <h3>Cartago</h3>
                    <div class="score" id="cartago-score">0</div>
                </div>
                <div class="house-card hipona">
                    <h3>Hipona</h3>
                    <div class="score" id="hipona-score">0</div>
                </div>
                <div class="house-card milan">
                    <h3>Milán</h3>
                    <div class="score" id="milan-score">0</div>
                </div>
                <div class="house-card tagaste">
                    <h3>Tagaste</h3>
                    <div class="score" id="tagaste-score">0</div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="scoreChart"></canvas>
            </div>
            
            <h3>Resultados por Grado</h3>
            <table class="results-table" id="results-by-grade">
                <thead>
                    <tr>
                        <th>Grado</th>
                        <th>Cartago</th>
                        <th>Hipona</th>
                        <th>Milán</th>
                        <th>Tagaste</th>
                        <th>Ganador</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Los datos se llenarán con JavaScript -->
                </tbody>
            </table>
        </div>
        
        <!-- Página de login -->
        <div id="login" class="page">
            <div class="login-form">
                <h2>Ingresar al Sistema</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Usuario:</label>
                        <input type="text" id="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Contraseña:</label>
                        <input type="password" id="password" required>
                    </div>
                    <button type="submit">Ingresar</button>
                </form>
            </div>
        </div>
        
        <!-- Página de ingreso de puntos (solo visible después del login) -->
        <div id="points-entry" class="page">
            <h2>Ingresar Puntos</h2>
            <button id="logout-btn" class="logout-btn">Cerrar Sesión</button>
            
            <!-- Sección para seleccionar grado -->
            <div class="grade-section">
                <h3>Seleccionar Grado</h3>
                <div class="form-group">
                    <label for="grade-select">Grado:</label>
                    <select id="grade-select">
                        <option value="">Seleccionar grado</option>
                        <option value="pre-kinder">Pre Kinder</option>
                        <option value="kinder">Kinder</option>
                        <option value="1ro">1er Grado</option>
                        <option value="2do">2do Grado</option>
                        <option value="3ro">3er Grado</option>
                        <option value="4to">4to Grado</option>
                        <option value="5to">5to Grado</option>
                        <option value="6to">6to Grado</option>
                        <option value="7mo">7mo Grado</option>
                        <option value="8vo">8vo Grado</option>
                        <option value="9no">9no Grado</option>
                        <option value="10mo">10mo Grado</option>
                        <option value="11mo">11mo Grado</option>
                    </select>
                </div>
                <div id="current-grade-display" class="current-grade" style="display: none;">
                    Grado seleccionado: <span id="selected-grade">Ninguno</span>
                </div>
            </div>
            
            <div class="points-form">
                <div class="form-section">
                    <h3>Deportes Colectivos</h3>
                    <div class="form-group">
                        <label for="collective-sport">Deporte:</label>
                        <select id="collective-sport">
                            <option value="">Seleccionar deporte</option>
                            <option value="futbol-varones">Fútbol Varones</option>
                            <option value="futbol-damas">Fútbol Damas</option>
                            <option value="voley-masculino">Voley Masculino</option>
                            <option value="voley-femenino">Voley Femenino</option>
                            <option value="basket-varones">Basket Varones</option>
                            <option value="basket-damas">Basket Damas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="collective-position">Posición:</label>
                        <select id="collective-position">
                            <option value="">Seleccionar posición</option>
                            <option value="1">1er Puesto (100 pts)</option>
                            <option value="2">2do Puesto (80 pts)</option>
                            <option value="3">3er Puesto (60 pts)</option>
                            <option value="4">4to Puesto (40 pts)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="collective-house">Casa:</label>
                        <select id="collective-house">
                            <option value="">Seleccionar casa</option>
                            <option value="cartago">Cartago</option>
                            <option value="hipona">Hipona</option>
                            <option value="milan">Milán</option>
                            <option value="tagaste">Tagaste</option>
                        </select>
                    </div>
                    <button id="add-collective-points">Agregar Puntos</button>
                </div>
                
                <div class="form-section">
                    <h3>Deportes Individuales</h3>
                    <div class="form-group">
                        <label for="individual-sport">Deporte:</label>
                        <select id="individual-sport">
                            <option value="">Seleccionar deporte</option>
                            <option value="velocidad">Velocidad (80 mt)</option>
                            <option value="salto-largo">Salto Largo</option>
                            <option value="maraton">Maratón</option>
                            <option value="natacion-libre">Natación 25mt Libre</option>
                            <option value="natacion-espalda">Natación 25mt Espalda</option>
                            <option value="natacion-pecho">Natación 25mt Pecho</option>
                            <option value="natacion-mariposa">Natación 25mt Mariposa</option>
                            <option value="natacion-combinado">Natación 100mt Combinado</option>
                            <option value="tenis-mesa">Tenis de Mesa</option>
                            <option value="ajedrez">Ajedrez</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="individual-position">Posición:</label>
                        <select id="individual-position">
                            <option value="">Seleccionar posición</option>
                            <option value="1">1er Puesto (20 pts)</option>
                            <option value="2">2do Puesto (16 pts)</option>
                            <option value="3">3er Puesto (14 pts)</option>
                            <option value="4">4to Puesto (12 pts)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="individual-house">Casa:</label>
                        <select id="individual-house">
                            <option value="">Seleccionar casa</option>
                            <option value="cartago">Cartago</option>
                            <option value="hipona">Hipona</option>
                            <option value="milan">Milán</option>
                            <option value="tagaste">Tagaste</option>
                        </select>
                    </div>
                    <button id="add-individual-points">Agregar Puntos</button>
                </div>
            </div>
            
            <div id="points-message" style="margin-top: 20px; padding: 10px; display: none;"></div>
        </div>
    </div>

    <script>
        // Datos de ejemplo para las casas
        let houses = {
            cartago: { name: "Cartago", color: "#4CAF50", score: 0 },
            hipona: { name: "Hipona", color: "#2196F3", score: 0 },
            milan: { name: "Milán", color: "#F44336", score: 0 },
            tagaste: { name: "Tagaste", color: "#FFC107", score: 0 }
        };
        
        // Puntos por posición
        const collectivePoints = {1: 100, 2: 80, 3: 60, 4: 40};
        const individualPoints = {1: 20, 2: 16, 3: 14, 4: 12};
        
        // Credenciales de acceso (en un caso real, esto estaría en el servidor)
        const validCredentials = {
            username: "admin",
            password: "admin123"
        };
        
        // Variable para almacenar el grado seleccionado
        let selectedGrade = "";
        
        // Estructura para almacenar puntos por grado y casa
        let pointsByGrade = {};
        
        // Inicializar estructura de puntos por grado
        function initializePointsByGrade() {
            const grades = ['pre-kinder', 'kinder', '1ro', '2do', '3ro', '4to', '5to', 
                           '6to', '7mo', '8vo', '9no', '10mo', '11mo'];
            
            grades.forEach(grade => {
                pointsByGrade[grade] = {
                    cartago: 0,
                    hipona: 0,
                    milan: 0,
                    tagaste: 0
                };
            });
        }
        
        // Elementos del DOM
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logout-btn');
        const addCollectiveBtn = document.getElementById('add-collective-points');
        const addIndividualBtn = document.getElementById('add-individual-points');
        const pointsMessage = document.getElementById('points-message');
        const gradeSelect = document.getElementById('grade-select');
        const currentGradeDisplay = document.getElementById('current-grade-display');
        const selectedGradeSpan = document.getElementById('selected-grade');
        const reportBtn = document.getElementById('report-btn');
        
        // Navegación entre páginas
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetPage = link.getAttribute('data-page');
                
                // Si intenta acceder a la página de ingreso de puntos sin estar logueado
                if (targetPage === 'points-entry' && !isLoggedIn()) {
                    showPage('login');
                    return;
                }
                
                showPage(targetPage);
            });
        });
        
        // Mostrar página específica
        function showPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
                if (page.id === pageId) {
                    page.classList.add('active');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('data-page') === pageId) {
                    link.classList.add('active');
                }
            });
        }
        
        // Verificar si el usuario está logueado
        function isLoggedIn() {
            return localStorage.getItem('isLoggedIn') === 'true';
        }
        
        // Manejo del formulario de login
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === validCredentials.username && password === validCredentials.password) {
                localStorage.setItem('isLoggedIn', 'true');
                showPage('points-entry');
            } else {
                alert('Usuario o contraseña incorrectos');
            }
        });
        
        // Cerrar sesión
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('isLoggedIn');
            selectedGrade = "";
            updateGradeDisplay();
            showPage('login');
        });
        
        // Manejar selección de grado
        gradeSelect.addEventListener('change', (e) => {
            selectedGrade = e.target.value;
            updateGradeDisplay();
        });
        
        // Actualizar display del grado seleccionado
        function updateGradeDisplay() {
            if (selectedGrade) {
                const gradeText = getGradeText(selectedGrade);
                selectedGradeSpan.textContent = gradeText;
                currentGradeDisplay.style.display = 'block';
            } else {
                currentGradeDisplay.style.display = 'none';
            }
        }
        
        // Obtener texto del grado
        function getGradeText(gradeValue) {
            const grades = {
                'pre-kinder': 'Pre Kinder',
                'kinder': 'Kinder',
                '1ro': '1er Grado',
                '2do': '2do Grado',
                '3ro': '3er Grado',
                '4to': '4to Grado',
                '5to': '5to Grado',
                '6to': '6to Grado',
                '7mo': '7mo Grado',
                '8vo': '8vo Grado',
                '9no': '9no Grado',
                '10mo': '10mo Grado',
                '11mo': '11mo Grado'
            };
            return grades[gradeValue] || 'Ninguno';
        }
        
        // Agregar puntos para deportes colectivos
        addCollectiveBtn.addEventListener('click', () => {
            if (!validateGradeSelection()) return;
            
            const sport = document.getElementById('collective-sport').value;
            const position = document.getElementById('collective-position').value;
            const house = document.getElementById('collective-house').value;
            
            if (!sport || !position || !house) {
                showMessage('Por favor, complete todos los campos', 'error');
                return;
            }
            
            const points = collectivePoints[position];
            
            // Actualizar puntos por casa general
            houses[house].score += points;
            
            // Actualizar puntos por grado y casa
            pointsByGrade[selectedGrade][house] += points;
            
            updateScores();
            showMessage(`Se agregaron ${points} puntos a ${houses[house].name} por ${sport} en ${getGradeText(selectedGrade)}`, 'success');
            
            // Limpiar formulario
            document.getElementById('collective-sport').value = '';
            document.getElementById('collective-position').value = '';
            document.getElementById('collective-house').value = '';
        });
        
        // Agregar puntos para deportes individuales
        addIndividualBtn.addEventListener('click', () => {
            if (!validateGradeSelection()) return;
            
            const sport = document.getElementById('individual-sport').value;
            const position = document.getElementById('individual-position').value;
            const house = document.getElementById('individual-house').value;
            
            if (!sport || !position || !house) {
                showMessage('Por favor, complete todos los campos', 'error');
                return;
            }
            
            const points = individualPoints[position];
            
            // Actualizar puntos por casa general
            houses[house].score += points;
            
            // Actualizar puntos por grado y casa
            pointsByGrade[selectedGrade][house] += points;
            
            updateScores();
            showMessage(`Se agregaron ${points} puntos a ${houses[house].name} por ${sport} en ${getGradeText(selectedGrade)}`, 'success');
            
            // Limpiar formulario
            document.getElementById('individual-sport').value = '';
            document.getElementById('individual-position').value = '';
            document.getElementById('individual-house').value = '';
        });
        
        // Validar que se haya seleccionado un grado
        function validateGradeSelection() {
            if (!selectedGrade) {
                showMessage('Por favor, seleccione un grado primero', 'error');
                return false;
            }
            return true;
        }
        
        // Mostrar mensajes
        function showMessage(text, type) {
            pointsMessage.textContent = text;
            pointsMessage.style.display = 'block';
            pointsMessage.style.backgroundColor = type === 'success' ? '#d4edda' : '#f8d7da';
            pointsMessage.style.color = type === 'success' ? '#155724' : '#721c24';
            pointsMessage.style.border = type === 'success' ? '1px solid #c3e6cb' : '1px solid #f5c6cb';
            
            setTimeout(() => {
                pointsMessage.style.display = 'none';
            }, 3000);
        }
        
        // Actualizar puntajes en la interfaz
        function updateScores() {
            document.getElementById('cartago-score').textContent = houses.cartago.score;
            document.getElementById('hipona-score').textContent = houses.hipona.score;
            document.getElementById('milan-score').textContent = houses.milan.score;
            document.getElementById('tagaste-score').textContent = houses.tagaste.score;
            
            updateChart();
            updateGradeTable();
        }
        
        // Actualizar gráfico
        let scoreChart;
        function updateChart() {
            const ctx = document.getElementById('scoreChart').getContext('2d');
            
            if (scoreChart) {
                scoreChart.destroy();
            }
            
            scoreChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.values(houses).map(house => house.name),
                    datasets: [{
                        label: 'Puntos',
                        data: Object.values(houses).map(house => house.score),
                        backgroundColor: Object.values(houses).map(house => house.color),
                        borderColor: Object.values(houses).map(house => house.color),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Actualizar tabla de resultados por grado
        function updateGradeTable() {
            const tableBody = document.querySelector('#results-by-grade tbody');
            tableBody.innerHTML = '';
            
            const grades = ['pre-kinder', 'kinder', '1ro', '2do', '3ro', '4to', '5to', 
                           '6to', '7mo', '8vo', '9no', '10mo', '11mo'];
            
            grades.forEach(grade => {
                const row = document.createElement('tr');
                
                const cartagoScore = pointsByGrade[grade].cartago;
                const hiponaScore = pointsByGrade[grade].hipona;
                const milanScore = pointsByGrade[grade].milan;
                const tagasteScore = pointsByGrade[grade].tagaste;
                
                const scores = {
                    cartago: cartagoScore,
                    hipona: hiponaScore,
                    milan: milanScore,
                    tagaste: tagasteScore
                };
                
                // Encontrar el ganador (puede haber empate)
                let winner = '';
                const maxScore = Math.max(cartagoScore, hiponaScore, milanScore, tagasteScore);
                
                if (maxScore > 0) {
                    if (cartagoScore === maxScore) winner = 'cartago';
                    if (hiponaScore === maxScore) winner = 'hipona';
                    if (milanScore === maxScore) winner = 'milan';
                    if (tagasteScore === maxScore) winner = 'tagaste';
                }
                
                row.innerHTML = `
                    <td>${getGradeText(grade)}</td>
                    <td>${cartagoScore}</td>
                    <td>${hiponaScore}</td>
                    <td>${milanScore}</td>
                    <td>${tagasteScore}</td>
                    <td class="winner-cell" style="color: ${winner ? houses[winner].color : '#333'}">
                        ${winner ? houses[winner].name : '-'}
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Generar reporte PDF
        reportBtn.addEventListener('click', generatePDF);
        
        function generatePDF() {
            // Crear elemento temporal para el PDF
            const pdfElement = document.createElement('div');
            pdfElement.style.padding = '20px';
            pdfElement.style.fontFamily = 'Arial, sans-serif';
            
            // Obtener fecha y hora actual
            const now = new Date();
            const fechaHora = now.toLocaleString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Construir contenido del PDF
            pdfElement.innerHTML = `
                <div class="pdf-header">
                    <h1>Marcador de Competencias - Reporte</h1>
                    <p>Generado el: ${fechaHora}</p>
                </div>
                
                <div class="pdf-section">
                    <h2>Resultados por Casa</h2>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0;">
                        <div style="background-color: ${houses.cartago.color}; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                            <h3>Cartago</h3>
                            <div style="font-size: 24px; font-weight: bold;">${houses.cartago.score}</div>
                        </div>
                        <div style="background-color: ${houses.hipona.color}; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                            <h3>Hipona</h3>
                            <div style="font-size: 24px; font-weight: bold;">${houses.hipona.score}</div>
                        </div>
                        <div style="background-color: ${houses.milan.color}; color: white; padding: 15px; border-radius: 8px; text-align: center;">
                            <h3>Milán</h3>
                            <div style="font-size: 24px; font-weight: bold;">${houses.milan.score}</div>
                        </div>
                        <div style="background-color: ${houses.tagaste.color}; padding: 15px; border-radius: 8px; text-align: center;">
                            <h3>Tagaste</h3>
                            <div style="font-size: 24px; font-weight: bold;">${houses.tagaste.score}</div>
                        </div>
                    </div>
                </div>
                
                <div class="pdf-section">
                    <h2>Gráfico de Resultados</h2>
                    <div class="pdf-chart-container">
                        <canvas id="pdfChart"></canvas>
                    </div>
                </div>
                
                <div class="pdf-section">
                    <h2>Resultados por Grado</h2>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                        <thead>
                            <tr style="background-color: #f2f2f2;">
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Grado</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Cartago</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Hipona</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Milán</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Tagaste</th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Ganador</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${generateGradeTableHTML()}
                        </tbody>
                    </table>
                </div>
                
                <div class="pdf-footer">
                    <p>Reporte generado automáticamente por el Sistema de Marcador de Competencias</p>
                    <p>${fechaHora}</p>
                </div>
            `;
            
            // Agregar al documento temporalmente
            document.body.appendChild(pdfElement);
            
            // Crear gráfico para el PDF
            const pdfChartCanvas = pdfElement.querySelector('#pdfChart');
            const pdfChartCtx = pdfChartCanvas.getContext('2d');
            
            new Chart(pdfChartCtx, {
                type: 'bar',
                data: {
                    labels: Object.values(houses).map(house => house.name),
                    datasets: [{
                        label: 'Puntos',
                        data: Object.values(houses).map(house => house.score),
                        backgroundColor: Object.values(houses).map(house => house.color),
                        borderColor: Object.values(houses).map(house => house.color),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Configurar opciones para PDF
            const options = {
                margin: 10,
                filename: `reporte_competencias_${now.getTime()}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            // Generar PDF
            html2pdf()
                .set(options)
                .from(pdfElement)
                .save()
                .finally(() => {
                    // Limpiar elemento temporal
                    document.body.removeChild(pdfElement);
                });
        }
        
        // Generar HTML para la tabla de grados en el PDF
        function generateGradeTableHTML() {
            const grades = ['pre-kinder', 'kinder', '1ro', '2do', '3ro', '4to', '5to', 
                           '6to', '7mo', '8vo', '9no', '10mo', '11mo'];
            
            return grades.map(grade => {
                const cartagoScore = pointsByGrade[grade].cartago;
                const hiponaScore = pointsByGrade[grade].hipona;
                const milanScore = pointsByGrade[grade].milan;
                const tagasteScore = pointsByGrade[grade].tagaste;
                
                const scores = [cartagoScore, hiponaScore, milanScore, tagasteScore];
                const maxScore = Math.max(...scores);
                
                let winner = '';
                if (maxScore > 0) {
                    if (cartagoScore === maxScore) winner = houses.cartago.name;
                    if (hiponaScore === maxScore) winner = houses.hipona.name;
                    if (milanScore === maxScore) winner = houses.milan.name;
                    if (tagasteScore === maxScore) winner = houses.tagaste.name;
                }
                
                return `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${getGradeText(grade)}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${cartagoScore}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${hiponaScore}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${milanScore}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${tagasteScore}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold; color: ${winner ? (winner === 'Cartago' ? houses.cartago.color : winner === 'Hipona' ? houses.hipona.color : winner === 'Milán' ? houses.milan.color : houses.tagaste.color) : '#333'}">
                            ${winner || '-'}
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Inicializar la aplicación
        function init() {
            initializePointsByGrade();
            updateScores();
            
            // Si está logueado, mostrar la página de ingreso de puntos
            if (isLoggedIn()) {
                showPage('points-entry');
            }
        }
        
        // Ejecutar inicialización cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
